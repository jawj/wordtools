# ruby ~/Development/wordtools/src/words/prep-multiwords.rb < multiwords.txt

# first: get all non-ASCII letters

# odds = ''
# ARGF.each_line do |line|
#   odd = line.gsub(/[- 'a-z]+/i, '')
#   odds += odd unless odd.empty?
# end
# puts odds.split('').sort.uniq.join('')

# !"&()*+,./:;?@`Â°Â·Â¼ÃÃ…Ã†Ã‰ÃŽÃ“Ã–Ã˜ÃšÃœÃŸÃ Ã¡Ã¢Ã£Ã¤Ã¥Ã¦Ã§Ã¨Ã©ÃªÃ«Ã¬Ã­Ã®Ã¯Ã°Ã±Ã²Ã³Ã´ÃµÃ¶Ã¸ÃºÃ»Ã¼Ã½ÄÄƒÄ…Ä‡ÄŒÄÄÄ‘Ä—Ä™Ä›ÄŸÄ©Ä«Ä±ÅÅ‚Å„ÅˆÅŒÅÅ‘Å“Å™ÅšÅ Å¡Å©Å«Å­Å¯Å³Å·ÅºÅ»Å¼Å½Å¾Æ¡Æ°ÇƒÇÇ«È˜È™È›ÉÊ”ÊŸÊ»Ê¼Ê½ÌÌÌ“Ì Ì¨Ì±Î©Î±Î²Î³Î´Î¸Î¼Ï€ÏƒÏˆá¸¥á¹‡á¹šá¹¢á¹³áº’áº•áº¡áº£áº¤áº¥áº§áº­áº¯áº±áºµáº¿á»á»‡á»‹á»á»‘á»“á»™á»›á»á»¥á»§á»«á»³á»µâ€“â€”â€˜â€™â€œâ€â€¦â€²â‚‚â„â˜•â™­â±¡ã„ãªêžŒð‘ðŸ§¢

replacements = {
  ' ' => ' ',
  '-' => ' ',
  'â€“' => ' ',
  'â€”' => ' ',
  '+' => '',
  '`' => '',
  '(' => '',
  ')' => '',
  '!' => '',
  ';' => '',
  ':' => '',
  '?' => '',
  ',' => '',
  '.' => '',
  '"' => '',
  "'" => '',
  'â€˜' => '',
  'â€™' => '',
  'â€œ' => '',
  'â€' => '',
  'â€¦' => '',
  'â€²' => '',
  'Ê»' => '',
  'Ê¼' => '',
  '/' => '',
  'Â°' => 'degrees',
  '@' => 'at',
  '&' => 'and',
  'Â¼' => 'quarter',
  'Ã' => 'A',
  'Ã…' => 'A', 
  'Ã†' => 'AE',
  'Ã‰' => 'E', 
  'ÃŽ' => 'I',
  'Ã“' => 'O',
  'Ã–' => 'O',
  'Ã˜' => 'O',
  'Ãš' => 'U',
  'Ãœ' => 'U',
  'ÃŸ' => 'ss',
  'Ã ' => 'a',
  'Ã¡' => 'a',
  'Ã¢' => 'a',
  'Ã£' => 'a',
  'Ã¤' => 'a',
  'Ã¥' => 'a',
  'Ã¦' => 'ae',
  'Ã§' => 'c',
  'Ã¨' => 'e',
  'Ã©' => 'e',
  'Ãª' => 'e',
  'Ã«' => 'e',
  'Ã¬' => 'i',
  'Ã­' => 'i',
  'Ã®' => 'i', 
  'Ã¯' => 'i',
  'Ã°' => 'th',
  'Ã±' => 'n',
  'Ã²' => 'o',
  'Ã³' => 'o',
  'Ã´' => 'o',
  'o' => 'Ãµ',
  'Ã¶' => 'o',
  'Ã¸' => 'o',
  'Ãº' => 'u',
  'Ã»' => 'u',
  'Ã¼' => 'u',
  'Ã½' => 'y',
  'Ä' => 'a',
  'Äƒ' => 'a',
  'Ä…' => 'a', 
  'Ä‡' => 'c',
  'ÄŒ' => 'C',
  'Ä' => 'c',
  'Ä' => 'D',
  'Ä‘' => 'd', 
  'Ä—' => 'e',
  'Ä™' => 'e',
  'Ä›' => 'e',
  'ÄŸ' => 'g',
  'Ä©' => 'i',
  'Ä«' => 'i',
  'Ä±' => 'i',
  'Å' => 'L',
  'Å‚' => 'l',
  'Å„' => 'n',
  'Åˆ' => 'n',
  'ÅŒ' => 'O',
  'Å' => 'o',
  'Å‘' => 'o',
  'Å“' => 'oe',
  'Å™' => 'r',
  'Åš' => 'S',
  'Å ' => 'S',
  'Å¡' => 's',
  'Å©' => 'u',
  'Å«' => 'u',
  'Å­' => 'u',
  'Å¯' => 'u',
  'Å³' => 'u',
  'Å·' => 'y',
  'Åº' => 'z', 
  'Å»' => 'Z',
  'Å¼' => 'z',
  'Å½' => 'Z',
  'Å¾' => 'z',
  'Æ¡' => 'o',
  'Æ°' => 'u',
  'Ç' => 'e',
  'Ç«' => 'o',
  'È˜' => 'S',
  'È™' => 's',
  'È›' => 't',
  'ÊŸ' => 'L',
  'Î©' => 'O',
  'Î±' => 'alpha',
  'Î²' => 'beta',
  'Î³' => 'gamma',
  'Î´' => 'delta',
  'Î¸' => 'theta',
  'Î¼' => 'mu',
  'Ï€' => 'pi',
  'Ïƒ' => 'sigma',
  'Ïˆ' => 'psi',
  'á¸¥' => 'h',
  'á¹‡' => 'n',
  'á¹š' => 'R',
  'á¹¢' => 'S',
  'á¹³' => 'u',
  'áº’' => 'Z',
  'áº•' => 'z',
  'áº¡' => 'a',
  'áº£' => 'a',
  'áº¤' => 'A',
  'áº¥' => 'a',
  'áº§' => 'a',
  'áº­' => 'a',
  'áº¯' => 'a',
  'áº±' => 'a',
  'áºµ' => 'a',
  'áº¿' => 'e',
  'á»' => 'e',
  'á»‡' => 'e',
  'á»‹' => 'i',
  'á»' => 'o',
  'á»‘' => 'o',
  'á»“' => 'o',
  'á»™' => 'o',
  'á»›' => 'o',
  'á»' => 'o',
  'á»¥' => 'u',
  'á»§' => 'u',
  'á»«' => 'u',
  'á»³' => 'y',
  'á»µ' => 'y',
  'â„' => 'R',
  'ð‘' => 'R',
}

pairs = ARGF.each_line.map do |line|
  line.strip!
  [line.gsub(/[^a-z]+/i) { |c| replacements[c] || c }.downcase.strip, line]
end

pairs = pairs.filter { |(subbed, line)| !line.match(/^-/) && !subbed.empty? && subbed.match?(/^[a-z ]+$/) }

pairs = pairs.sort { |a, b| a[0] <=> b[0] }.uniq { |(subbed, line)| subbed }

require 'json'
weights = JSON.load_file('/Users/george/Development/wordtools/docs/words.json')

pairs = pairs.map { |(subbed, line)|
  words = subbed.split(' ').filter { |word| !word.empty? }
  weight = words.reduce(0.0) { |memo, word| memo + (weights[word] || 0.5).to_f } / words.length.to_f
  [subbed.gsub(' ', ''), line, weight]
}.sort { |a, b| b[2] - a[2] }

result = pairs.reduce({}) do |memo, (subbed, line, weight)|
  memo[subbed] = [line, weight.round(2)]
  memo
end
puts JSON.generate(result, object_nl: "\n")
